<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistem Manajemen Perpustakaan Digital</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        :root {
            --primary-color: #2c3e50;
            --secondary-color: #3498db;
            --accent-color: #e74c3c;
            --background-color: #f5f6fa;
            --text-color: #2c3e50;
            --success-color: #2ecc71;
            --warning-color: #f1c40f;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: var(--background-color);
        }

        .container {
            display: flex;
            min-height: 100vh;
        }

        /* Sidebar Styles */
        .sidebar {
            width: 250px;
            background-color: var(--primary-color);
            color: white;
            padding: 20px;
            position: fixed;
            height: 100vh;
        }

        .sidebar h1 {
            font-size: 1.5em;
            margin-bottom: 30px;
            text-align: center;
            padding-bottom: 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .nav-item {
            padding: 15px;
            cursor: pointer;
            margin-bottom: 10px;
            border-radius: 5px;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
        }

        .nav-item:hover {
            background-color: var(--secondary-color);
            transform: translateX(5px);
        }

        .nav-item.active {
            background-color: var(--secondary-color);
        }

        .nav-item i {
            margin-right: 10px;
            width: 20px;
            text-align: center;
        }

        /* Main Content Styles */
        .main-content {
            flex: 1;
            margin-left: 250px;
            padding: 20px;
        }

        .header {
            background-color: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .search-bar {
            display: flex;
            gap: 10px;
        }

        .search-bar input {
            flex: 1;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        .search-bar input:focus {
            outline: none;
            border-color: var(--secondary-color);
        }

        .search-bar button {
            padding: 12px 24px;
            background-color: var(--secondary-color);
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        .search-bar button:hover {
            background-color: #2980b9;
        }

        .content-section {
            background-color: white;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }

        .content-section h2 {
            margin-bottom: 20px;
            color: var(--text-color);
            display: flex;
            align-items: center;
        }

        .content-section h2 i {
            margin-right: 10px;
        }

        /* Dashboard Cards */
        .dashboard-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .card {
            background-color: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            text-align: center;
            transition: transform 0.3s ease;
        }

        .card:hover {
            transform: translateY(-5px);
        }

        .card h3 {
            color: var(--text-color);
            margin-bottom: 15px;
            font-size: 1.1em;
        }

        .card .number {
            font-size: 2.5em;
            color: var(--secondary-color);
            font-weight: bold;
            margin-bottom: 10px;
        }

        .card .trend {
            color: var(--success-color);
            font-size: 0.9em;
        }

        /* Table Styles */
        .table-container {
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        th, td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }

        th {
            background-color: var(--primary-color);
            color: white;
            font-weight: 500;
        }

        tr:hover {
            background-color: #f8f9fa;
        }

        /* Status Badges */
        .status-badge {
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 0.85em;
            font-weight: 500;
        }

        .status-tersedia {
            background-color: var(--success-color);
            color: white;
        }

        .status-dipinjam {
            background-color: var(--warning-color);
            color: var(--text-color);
        }

        /* Button Styles */
        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9em;
            transition: all 0.3s ease;
        }

        .btn i {
            margin-right: 5px;
        }

        .btn-primary {
            background-color: var(--secondary-color);
            color: white;
        }

        .btn-danger {
            background-color: var(--accent-color);
            color: white;
        }

        .btn-success {
            background-color: var(--success-color);
            color: white;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }

        /* Form Styles */
        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: var(--text-color);
            font-weight: 500;
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: var(--secondary-color);
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            z-index: 1000;
        }

        .modal-content {
            background-color: white;
            width: 90%;
            max-width: 500px;
            margin: 50px auto;
            padding: 25px;
            border-radius: 10px;
            position: relative;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #ddd;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 1.5em;
            cursor: pointer;
            color: var(--text-color);
            transition: color 0.3s ease;
        }

        .modal-close:hover {
            color: var(--accent-color);
        }

        /* Alert Styles */
        .alert {
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            animation: slideIn 0.3s ease-out;
        }

        @keyframes slideIn {
            from {
                transform: translateY(-20px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .alert i {
            margin-right: 10px;
        }

        .alert-success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .alert-error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        /* Report Styles */
        .report-section {
            background-color: white;
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
        }

        .report-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .stat-item {
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 8px;
            text-align: center;
        }

        .stat-label {
            color: var(--text-color);
            font-size: 0.9em;
            margin-bottom: 5px;
            display: block;
        }

        .stat-value {
            font-size: 1.8em;
            color: var(--secondary-color);
            font-weight: bold;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .sidebar {
                width: 60px;
                padding: 20px 10px;
            }

            .sidebar h1 {
                display: none;
            }

            .nav-item span {
                display: none;
            }

            .main-content {
                margin-left: 60px;
            }

            .dashboard-cards {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Sidebar -->
        <div class="sidebar">
            <h1>Digital Library</h1>
            <div class="nav-item" onclick="showSection('dashboard')">
                <i class="fas fa-chart-line"></i>
                <span>Dashboard</span>
            </div>
            <div class="nav-item" onclick="showSection('books')">
                <i class="fas fa-book"></i>
                <span>Manajemen Buku</span>
            </div>
            <div class="nav-item" onclick="showSection('borrowing')">
                <i class="fas fa-handshake"></i>
                <span>Peminjaman</span>
            </div>
            <div class="nav-item" onclick="showSection('reports')">
                <i class="fas fa-file-alt"></i>
                <span>Laporan</span>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Header with Search -->
            <div class="header">
                <div class="search-bar">
                    <input type="text" placeholder="Cari buku berdasarkan judul, pengarang, atau kategori...">
                    <button onclick="searchBooks()">
                        <i class="fas fa-search"></i> Cari
                    </button>
                </div>
            </div>

            <!-- Dashboard Section -->
            <div id="dashboard" class="content-section">
                <h2><i class="fas fa-chart-line"></i> Dashboard</h2>
                <div class="dashboard-cards">
                    <div class="card">
                        <h3>Total Buku</h3>
                        <div id="totalBooks" class="number">0</div>
                        <div class="trend">
                            <i class="fas fa-arrow-up"></i> Koleksi Terkini
                        </div>
                    </div>
                    <div class="card">
                        <h3>Buku Dipinjam</h3>
                        <div id="borrowedBooks" class="number">0</div>
                        <div class="trend">Status Real-time</div>
                    </div>
                    <div class="card">
                        <h3>Anggota Aktif</h3>
                        <div id="activeMembers" class="number">0</div>
                        <div class="trend">Peminjam Bulan Ini</div>
                    </div>
                </div>

                <!-- Recent Activities -->
                <div class="recent-activities">
                    <h3>Aktivitas Terbaru</h3>
                    <div id="recentActivities"></div>
                </div>
            </div>

            <!-- Books Management Section -->
            <div id="books" class="content-section" style="display: none;">
                <h2><i class="fas fa-book"></i> Manajemen Buku</h2>
                <button class="btn btn-primary" onclick="showAddBookModal()">
                    <i class="fas fa-plus"></i> Tambah Buku
                </button>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Judul</th>
                                <th>Pengarang</th>
                                <th>Kategori</th>
                                <th>Status</th>
                                <th>Aksi</th>
                            </tr>
                        </thead>
                        <tbody id="booksTable">
                            <!-- Books data will be inserted here -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Borrowing Section -->
            <div id="borrowing" class="content-section" style="display: none;">
                <h2><i class="fas fa-handshake"></i> Peminjaman Buku</h2>
                <button class="btn btn-primary" onclick="showBorrowModal()">
                    <i class="fas fa-plus"></i> Pinjam Buku
                </button>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Peminjam</th>
                                <th>Buku</th>
                                <th>Tanggal Pinjam</th>
                                <th>Tanggal Kembali</th>
                                <th>Status</th>
                                <th>Aksi</th>
                            </tr>
                        </thead>
                        <tbody id="borrowingTable">
                            <!-- Borrowing data will be inserted here -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Reports Section -->
            <div id="reports" class="content-section" style="display: none;">
                <h2><i class="fas fa-file-alt"></i> Laporan Bulanan</h2>
                <div class="form-group">
                    <label>Pilih Tahun</label>
                    <select id="yearSelect" onchange="generateReport()">
                        <option value="2024">2024</option>
                        <option value="2023">2023</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Pilih Bulan</label>
                    <select id="monthSelect" onchange="generateReport()">
                        <option value="1">Januari</option>
                        <option value="2">Februari</option>
                        <option value="3">Maret</option>
                        <option value="4">April</option>
                        <option value="5">Mei</option>
                        <option value="6">Juni</option>
                        <option value="7">Juli</option>
                        <option value="8">Agustus</option>
                        <option value="9">September</option>
                        <option value="10">Oktober</option>
                        <option value="11">November</option>
                        <option value="12">Desember</option>
                    </select>
                </div>
                <button class="btn btn-primary" onclick="exportReport()">
                    <i class="fas fa-file-export"></i> Export Laporan
                </button>
                <div id="reportContent"></div>
            </div>
        </div>
    </div>

    <!-- Add Book Modal -->
    <div id="addBookModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2><i class="fas fa-book"></i> Tambah Buku Baru</h2>
                <button class="modal-close" onclick="closeModal('addBookModal')">&times;</button>
            </div>
            <form id="addBookForm">
                <div class="form-group">
                    <label>Judul Buku</label>
                    <input type="text" name="title" required>
                </div>
                <div class="form-group">
                    <label>Pengarang</label>
                    <input type="text" name="author" required>
                </div>
                <div class="form-group">
                    <label>Kategori</label>
                    <select name="category" required>
                        <option value="">Pilih Kategori</option>
                        <option value="Fiksi">Fiksi</option>
                        <option value="Non-Fiksi">Non-Fiksi</option>
                        <option value="Sains">Sains</option>
                        <option value="Teknologi">Teknologi</option>
                        <option value="Bisnis">Bisnis</option>
                        <option value="Pendidikan">Pendidikan</option>
                    </select>
                </div>
                <div class="modal-footer">
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-save"></i> Simpan
                    </button>
                    <button type="button" class="btn btn-danger" onclick="closeModal('addBookModal')">
                        <i class="fas fa-times"></i> Batal
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Borrow Modal -->
    <div id="borrowModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2><i class="fas fa-handshake"></i> Peminjaman Buku</h2>
                <button class="modal-close" onclick="closeModal('borrowModal')">&times;</button>
            </div>
            <form id="borrowForm">
                <div class="form-group">
                    <label>Nama Peminjam</label>
                    <input type="text" name="borrower" required>
                </div>
                <div class="form-group">
                    <label>ID Anggota</label>
                    <input type="text" name="memberId" required pattern="[A-Z]{2}[0-9]{4}" 
                           title="Format: 2 huruf kapital diikuti 4 angka (contoh: AA1234)">
                </div>
                <div class="form-group">
                    <label>Buku</label>
                    <select name="bookId" id="bookSelect" required>
                        <option value="">Pilih Buku</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Tanggal Peminjaman</label>
                    <input type="date" name="borrowDate" required>
                </div>
                <div class="form-group">
                    <label>Tanggal Pengembalian</label>
                    <input type="date" name="returnDate" required>
                </div>
                <div class="modal-footer">
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-save"></i> Simpan
                    </button>
                    <button type="button" class="btn btn-danger" onclick="closeModal('borrowModal')">
                        <i class="fas fa-times"></i> Batal
                    </button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Sample data with more realistic entries
        let books = [
            { id: 1, title: "The Great Gatsby", author: "F. Scott Fitzgerald", category: "Fiksi", status: "Tersedia" },
            { id: 2, title: "1984", author: "George Orwell", category: "Fiksi", status: "Dipinjam" },
            { id: 3, title: "Python Programming", author: "John Smith", category: "Teknologi", status: "Tersedia" },
            { id: 4, title: "Data Science Basics", author: "Sarah Johnson", category: "Teknologi", status: "Tersedia" },
            { id: 5, title: "The Art of Business", author: "Robert Greene", category: "Bisnis", status: "Dipinjam" }
        ];

        let borrowings = [
            { 
                id: 1, 
                borrower: "John Doe", 
                memberId: "AA1234",
                book: "The Great Gatsby", 
                borrowDate: "2024-03-01", 
                returnDate: "2024-03-15", 
                status: "Dipinjam" 
            },
            { 
                id: 2, 
                borrower: "Jane Smith", 
                memberId: "BB5678",
                book: "1984", 
                borrowDate: "2024-03-05", 
                returnDate: "2024-03-19", 
                status: "Dikembalikan" 
            },
            { 
                id: 3, 
                borrower: "Alice Johnson", 
                memberId: "CC9012",
                book: "The Art of Business", 
                borrowDate: "2024-03-10", 
                returnDate: "2024-03-24", 
                status: "Dipinjam" 
            }
        ];

        // Activity log for tracking recent actions
        let activityLog = [
            { 
                timestamp: new Date('2024-03-10T10:30:00'),
                action: "Peminjaman",
                details: "Alice Johnson meminjam The Art of Business"
            },
            { 
                timestamp: new Date('2024-03-05T14:15:00'),
                action: "Pengembalian",
                details: "Jane Smith mengembalikan 1984"
            }
        ];

        // Initialize display
        document.addEventListener('DOMContentLoaded', function() {
            updateDashboardNumbers();
            updateRecentActivities();
            setDefaultDates();
        });

        // Utility Functions
        function updateDashboardNumbers() {
            // Update total books
            document.getElementById('totalBooks').textContent = books.length;
            
            // Update borrowed books
            const borrowedCount = books.filter(book => book.status === "Dipinjam").length;
            document.getElementById('borrowedBooks').textContent = borrowedCount;
            
            // Update active members (unique borrowers with active loans)
            const activeMembers = new Set(
                borrowings
                    .filter(b => b.status === "Dipinjam")
                    .map(b => b.borrower)
            ).size;
            document.getElementById('activeMembers').textContent = activeMembers;
        }

        function updateRecentActivities() {
            const recentActivitiesDiv = document.getElementById('recentActivities');
            const sortedActivities = activityLog.sort((a, b) => b.timestamp - a.timestamp);
            
            recentActivitiesDiv.innerHTML = `
                <table>
                    <thead>
                        <tr>
                            <th>Waktu</th>
                            <th>Aktivitas</th>
                            <th>Detail</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${sortedActivities.map(activity => `
                            <tr>
                                <td>${formatDate(activity.timestamp)}</td>
                                <td>${activity.action}</td>
                                <td>${activity.details}</td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;
        }

        function setDefaultDates() {
            const today = new Date();
            const twoWeeksLater = new Date(today);
            twoWeeksLater.setDate(today.getDate() + 14);
            
            document.querySelectorAll('input[type="date"]').forEach(input => {
                if (input.name === 'borrowDate') {
                    input.value = formatDateForInput(today);
                    input.min = formatDateForInput(today);
                } else if (input.name === 'returnDate') {
                    input.value = formatDateForInput(twoWeeksLater);
                    input.min = formatDateForInput(today);
                }
            });
        }

        function formatDate(date) {
            return new Date(date).toLocaleString('id-ID', {
                year: 'numeric',
                month: 'long',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
        }

        function formatDateForInput(date) {
            return date.toISOString().split('T')[0];
        }

        function showAlert(message, type) {
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert alert-${type}`;
            alertDiv.innerHTML = `
                <i class="fas ${type === 'success' ? 'fa-check-circle' : 'fa-exclamation-circle'}"></i>
                ${message}
            `;
            
            const mainContent = document.querySelector('.main-content');
            mainContent.insertBefore(alertDiv, mainContent.firstChild);
            
            setTimeout(() => alertDiv.remove(), 3000);
        }

        // Navigation Functions
        function showSection(sectionId) {
            // Update active nav item
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
                if (item.textContent.toLowerCase().includes(sectionId)) {
                    item.classList.add('active');
                }
            });

            // Hide all sections and show selected section
            document.querySelectorAll('.content-section').forEach(section => {
                section.style.display = 'none';
            });
            document.getElementById(sectionId).style.display = 'block';
            
            // Update content based on section
            if (sectionId === 'dashboard') {
                updateDashboardNumbers();
                updateRecentActivities();
            } else if (sectionId === 'books') {
                renderBooks();
            } else if (sectionId === 'borrowing') {
                renderBorrowings();
            }
        }

        // Book Management Functions
        function renderBooks() {
            const booksTable = document.getElementById('booksTable');
            booksTable.innerHTML = books.map(book => `
                <tr>
                    <td>${book.title}</td>
                    <td>${book.author}</td>
                    <td>${book.category}</td>
                    <td>
                        <span class="status-badge status-${book.status.toLowerCase()}">
                            ${book.status}
                        </span>
                    </td>
                    <td>
                        <button class="btn btn-primary" onclick="editBook(${book.id})">
                            <i class="fas fa-edit"></i> Edit
                        </button>
                        <button class="btn btn-danger" onclick="deleteBook(${book.id})">
                            <i class="fas fa-trash"></i> Hapus
                        </button>
                    </td>
                </tr>
            `).join('');
        }

        function showAddBookModal() {
            const modal = document.getElementById('addBookModal');
            const form = document.getElementById('addBookForm');
            form.reset();
            modal.style.display = 'block';
        }

        function editBook(id) {
            const book = books.find(b => b.id === id);
            if (!book) return;
            
            const modal = document.getElementById('addBookModal');
            const form = document.getElementById('addBookForm');
            
            form.title.value = book.title;
            form.author.value = book.author;
            form.category.value = book.category;
            
            modal.style.display = 'block';
            
            // Update form submission handler
            form.onsubmit = function(e) {
                e.preventDefault();
                book.title = this.title.value;
                book.author = this.author.value;
                book.category = this.category.value;
                
                renderBooks();
                closeModal('addBookModal');
                showAlert('Buku berhasil diperbarui!', 'success');
                
                // Reset form handler
                this.onsubmit = addBookHandler;
            };
        }

        function deleteBook(id) {
            if (confirm('Apakah Anda yakin ingin menghapus buku ini?')) {
                const bookIndex = books.findIndex(b => b.id === id);
                if (bookIndex === -1) return;

                const book = books[bookIndex];
                
                // Check if book is currently borrowed
                if (book.status === 'Dipinjam') {
                    showAlert('Buku sedang dipinjam dan tidak dapat dihapus!', 'error');
                    return;
                }

                books.splice(bookIndex, 1);
                renderBooks();
                updateDashboardNumbers();
                
                // Log activity
                addActivity('Penghapusan', `Buku "${book.title}" telah dihapus dari sistem`);
                
                showAlert('Buku berhasil dihapus!', 'success');
            }
        }

        // Borrowing Functions
        function renderBorrowings() {
            const borrowingTable = document.getElementById('borrowingTable');
            borrowingTable.innerHTML = borrowings.map(borrowing => `
                <tr>
                    <td>
                        ${borrowing.borrower}<br>
                        <small class="text-muted">${borrowing.memberId}</small>
                    </td>
                    <td>${borrowing.book}</td>
                    <td>${formatDateForDisplay(borrowing.borrowDate)}</td>
                    <td>${formatDateForDisplay(borrowing.returnDate)}</td>
                    <td>
                        <span class="status-badge status-${borrowing.status.toLowerCase()}">
                            ${borrowing.status}
                        </span>
                    </td>
                    <td>
                        ${borrowing.status === 'Dipinjam' ? 
                            `<button class="btn btn-success" onclick="returnBook(${borrowing.id})">
                                <i class="fas fa-undo"></i> Kembalikan
                            </button>` : 
                            '<span class="text-muted">-</span>'}
                    </td>
                </tr>
            `).join('');
        }

        function showBorrowModal() {
            const modal = document.getElementById('borrowModal');
            const form = document.getElementById('borrowForm');
            form.reset();
            
            // Populate available books
            const bookSelect = document.getElementById('bookSelect');
            const availableBooks = books.filter(b => b.status === 'Tersedia');
            
            bookSelect.innerHTML = `
                <option value="">Pilih Buku</option>
                ${availableBooks.map(book => 
                    `<option value="${book.id}">${book.title}</option>`
                ).join('')}
            `;

            setDefaultDates();
            modal.style.display = 'block';
        }

        function addBorrowing(borrowData) {
            const book = books.find(b => b.id === parseInt(borrowData.bookId));
            if (!book) {
                showAlert('Buku tidak ditemukan!', 'error');
                return;
            }

            const newBorrowing = {
                id: borrowings.length + 1,
                borrower: borrowData.borrower,
                memberId: borrowData.memberId,
                book: book.title,
                borrowDate: borrowData.borrowDate,
                returnDate: borrowData.returnDate,
                status: 'Dipinjam'
            };

            borrowings.push(newBorrowing);
            book.status = 'Dipinjam';

            // Log activity
            addActivity('Peminjaman', `${borrowData.borrower} meminjam "${book.title}"`);

            renderBorrowings();
            updateDashboardNumbers();
            showAlert('Peminjaman berhasil dicatat!', 'success');
        }

        function returnBook(id) {
            const borrowing = borrowings.find(b => b.id === id);
            if (!borrowing) return;

            borrowing.status = 'Dikembalikan';
            const book = books.find(b => b.title === borrowing.book);
            if (book) {
                book.status = 'Tersedia';
            }

            // Log activity
            addActivity('Pengembalian', `${borrowing.borrower} mengembalikan "${borrowing.book}"`);

            renderBorrowings();
            updateDashboardNumbers();
            showAlert('Buku berhasil dikembalikan!', 'success');
        }

        // Report Functions
        function generateReport() {
            const year = document.getElementById('yearSelect').value;
            const month = document.getElementById('monthSelect').value;
            const reportContent = document.getElementById('reportContent');

            // Filter borrowings for selected month and year
            const monthlyBorrowings = borrowings.filter(b => {
                const borrowDate = new Date(b.borrowDate);
                return borrowDate.getMonth() + 1 === parseInt(month) && 
                       borrowDate.getFullYear() === parseInt(year);
            });

            // Calculate statistics
            const totalBorrowings = monthlyBorrowings.length;
            const returnedBooks = monthlyBorrowings.filter(b => b.status === 'Dikembalikan').length;
            const activeBorrowings = monthlyBorrowings.filter(b => b.status === 'Dipinjam').length;
            const uniqueBorrowers = new Set(monthlyBorrowings.map(b => b.memberId)).size;

            // Generate report HTML
            reportContent.innerHTML = `
                <div class="report-section">
                    <h3>Laporan Peminjaman - ${getMonthName(month)} ${year}</h3>
                    <div class="report-stats">
                        <div class="stat-item">
                            <span class="stat-label">Total Peminjaman</span>
                            <span class="stat-value">${totalBorrowings}</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Buku Dikembalikan</span>
                            <span class="stat-value">${returnedBooks}</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Buku Masih Dipinjam</span>
                            <span class="stat-value">${activeBorrowings}</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Jumlah Peminjam</span>
                            <span class="stat-value">${uniqueBorrowers}</span>
                        </div>
                    </div>
                    
                    <h4 class="mt-4">Detail Peminjaman</h4>
                    <table>
                        <thead>
                            <tr>
                                <th>Peminjam</th>
                                <th>Buku</th>
                                <th>Tanggal Pinjam</th>
                                <th>Tanggal Kembali</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${monthlyBorrowings.map(b => `
                                <tr>
                                    <td>${b.borrower}<br><small>${b.memberId}</small></td>
                                    <td>${b.book}</td>
                                    <td>${formatDateForDisplay(b.borrowDate)}</td>
                                    <td>${formatDateForDisplay(b.returnDate)}</td>
                                    <td>${b.status}</td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                </div>
            `;
        }

        function exportReport() {
            const year = document.getElementById('yearSelect').value;
            const month = document.getElementById('monthSelect').value;
            const fileName = `laporan_perpustakaan_${getMonthName(month).toLowerCase()}_${year}.csv`;
            
            // In a real application, this would generate and download a CSV file
            showAlert('Laporan telah diexport: ' + fileName, 'success');
        }

        // Event Handlers
        document.getElementById('addBookForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const formData = new FormData(this);
            
            const newBook = {
                id: books.length + 1,
                title: formData.get('title'),
                author: formData.get('author'),
                category: formData.get('category'),
                status: 'Tersedia'
            };
            
            books.push(newBook);
            
            // Log activity
            addActivity('Penambahan Buku', `Buku baru "${newBook.title}" ditambahkan`);
            
            renderBooks();
            updateDashboardNumbers();
            this.reset();
            closeModal('addBookModal');
            showAlert('Buku berhasil ditambahkan!', 'success');
        });

        document.getElementById('borrowForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const formData = new FormData(this);
            
            const borrowData = {
                borrower: formData.get('borrower'),
                memberId: formData.get('memberId'),
                bookId: formData.get('bookId'),
                borrowDate: formData.get('borrowDate'),
                returnDate: formData.get('returnDate')
            };
            
            addBorrowing(borrowData);
            this.reset();
            closeModal('borrowModal');
        });

        // Helper Functions
        function addActivity(action, details) {
            activityLog.unshift({
                timestamp: new Date(),
                action: action,
                details: details
            });
            updateRecentActivities();
        }

        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        function getMonthName(month) {
            const months = [
                'Januari', 'Februari', 'Maret', 'April', 'Mei', 'Juni',
                'Juli', 'Agustus', 'September', 'Oktober', 'November', 'Desember'
            ];
            return months[parseInt(month) - 1];
        }

        function formatDateForDisplay(dateString) {
            const options = { day: 'numeric', month: 'long', year: 'numeric' };
            return new Date(dateString).toLocaleDateString('id-ID', options);
        }

        // Search functionality
        function searchBooks() {
            const searchTerm = document.querySelector('.search-bar input').value.toLowerCase();
            const filteredBooks = books.filter(book => 
                book.title.toLowerCase().includes(searchTerm) ||
                book.author.toLowerCase().includes(searchTerm) ||
                book.category.toLowerCase().includes(searchTerm)
            );
            
            const booksTable = document.getElementById('booksTable');
            booksTable.innerHTML = filteredBooks.map(book => `
                <tr>
                    <td>${book.title}</td>
                    <td>${book.author}</td>
                    <td>${book.category}</td>
                    <td>
                        <span class="status-badge status-${book.status.toLowerCase()}">
                            ${book.status}
                        </span>
                    </td>
                    <td>
                        <button class="btn btn-primary" onclick="editBook(${book.id})">
                            <i class="fas fa-edit"></i> Edit
                        </button>
                        <button class="btn btn-danger" onclick="deleteBook(${book.id})">
                            <i class="fas fa-trash"></i> Hapus
                        </button>
                    </td>
                </tr>
            `).join('');
        }

        // Initialize the application
        showSection('dashboard');
    </script>
</body>
</html>